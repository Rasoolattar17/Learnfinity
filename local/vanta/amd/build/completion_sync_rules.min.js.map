{"version":3,"file":"training_sync_rules.min.js","sources":["../src/training_sync_rules.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable promise/catch-or-return */\n/* eslint-disable promise/always-return */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'core/st_loader',\n    'core/url',\n    'select2-js'\n], function(\n    $,\n    str,\n    ajax,\n    notification,\n    templates,\n    stLoader,\n) {\n    \"use strict\";\n    var completionSyncRules = {\n        dom: {\n            main: null,\n            frameworksSelect: null,\n            coursesSelect: null,\n            completionModeContainer: null,\n            completionModeSelect: null,\n            saveButton: null,\n            form: null\n        },\n        lang: {\n            somethingWentWrong: null,\n            saveSuccess: null\n        },\n        variables: {\n            selectedFrameworks: [],\n            selectedCourses: []\n        },\n        action: {\n            getStringValues: function() {\n                str.get_strings([\n                    {\n                        key: \"some_thing_went_wrong\",\n                        component: \"local_vanta\"\n                    },\n                    {\n                        key: \"settingssaved\",\n                        component: \"local_vanta\"\n                    }\n                ]).done(function(langstrs) {\n                    completionSyncRules.lang.somethingWentWrong = langstrs[0];\n                    completionSyncRules.lang.saveSuccess = langstrs[1];\n                    completionSyncRules.init();\n                }).fail(function() {\n                    notification.addNotification({\n                        type: \"error\",\n                        message: \"Failed to load language strings\"\n                    });\n                });\n            },\n\n            setupEventListeners: function() {\n                // Initialize select2 on frameworks\n                completionSyncRules.dom.frameworksSelect.select2({\n                    placeholder: \"Select compliance frameworks\",\n                    allowClear: true,\n                    width: '100%'\n                });\n\n                // Initialize select2 on courses\n                completionSyncRules.dom.coursesSelect.select2({\n                    placeholder: \"Select courses\",\n                    allowClear: true,\n                    width: '100%'\n                });\n\n                // Handle course selection change for conditional display\n                completionSyncRules.dom.coursesSelect.on('change', function() {\n                    var selectedCourses = $(this).val();\n                    completionSyncRules.variables.selectedCourses = selectedCourses;\n\n                    // Show/hide completion mode selector based on number of selected courses\n                    if (selectedCourses && selectedCourses.length > 1) {\n                        completionSyncRules.dom.completionModeContainer.show();\n                    } else {\n                        completionSyncRules.dom.completionModeContainer.hide();\n                    }\n                });\n\n                // Handle frameworks selection change\n                completionSyncRules.dom.frameworksSelect.on('change', function() {\n                    completionSyncRules.variables.selectedFrameworks = $(this).val();\n                });\n\n                // Handle form submission\n                completionSyncRules.dom.form.on('submit', function(e) {\n                    e.preventDefault();\n                    completionSyncRules.action.saveSettings();\n                });\n            },\n\n            saveSettings: function() {\n                stLoader.showLoader();\n\n                var formData = {\n                    frameworks: completionSyncRules.variables.selectedFrameworks,\n                    courses: completionSyncRules.variables.selectedCourses,\n                    completionmode: completionSyncRules.dom.completionModeSelect.val(),\n                    resourceid: completionSyncRules.dom.resourceId.val(),\n                    sesskey: $('input[name=\"sesskey\"]').val()\n                };\n\n                // Use standard Moodle AJAX call to save settings\n                ajax.call([{\n                    methodname: 'local_vanta_save_sync_rules',\n                    args: formData\n                }])[0].done(function(response) {\n                    stLoader.hideLoader();\n\n                    if (response.success) {\n                        notification.addNotification({\n                            type: 'success',\n                            message: completionSyncRules.lang.saveSuccess\n                        });\n                    } else {\n                        notification.addNotification({\n                            type: 'error',\n                            message: response.message || completionSyncRules.lang.somethingWentWrong\n                        });\n                    }\n                }).fail(function(error) {\n                    stLoader.hideLoader();\n                    notification.addNotification({\n                        type: 'error',\n                        message: completionSyncRules.lang.somethingWentWrong\n                    });\n                    console.error(error);\n                });\n            },\n\n            // Initialize the state based on existing values\n            initializeState: function() {\n                // Trigger change event to handle initial visibility of completion mode\n                completionSyncRules.dom.coursesSelect.trigger('change');\n            }\n        },\n\n        init: function() {\n            // Initialize DOM references\n            completionSyncRules.dom.main = $('#local_vanta_training_sync_rules');\n            completionSyncRules.dom.form = $('#vanta-sync-rules-form');\n            completionSyncRules.dom.frameworksSelect = $('#frameworks');\n            completionSyncRules.dom.coursesSelect = $('#courses');\n            completionSyncRules.dom.resourceId = $('.resource_id');\n            completionSyncRules.dom.completionModeContainer = $('#completion_mode_container');\n            completionSyncRules.dom.completionModeSelect = $('#completion_mode');\n            completionSyncRules.dom.saveButton = $('#save_sync_rules');\n\n            // Store initial values\n            completionSyncRules.variables.selectedFrameworks = completionSyncRules.dom.frameworksSelect.val() || [];\n            completionSyncRules.variables.selectedCourses = completionSyncRules.dom.coursesSelect.val() || [];\n\n            // Set up event listeners\n            completionSyncRules.action.setupEventListeners();\n\n            // Initialize state\n            completionSyncRules.action.initializeState();\n        }\n    };\n    return {\n        init: completionSyncRules.action.getStringValues\n    };\n});"],"names":["define","$","str","ajax","notification","templates","stLoader","completionSyncRules","dom","main","frameworksSelect","coursesSelect","completionModeContainer","completionModeSelect","saveButton","form","lang","somethingWentWrong","saveSuccess","variables","selectedFrameworks","selectedCourses","action","getStringValues","get_strings","key","component","done","langstrs","init","fail","addNotification","type","message","setupEventListeners","select2","placeholder","allowClear","width","on","this","val","length","show","hide","e","preventDefault","saveSettings","showLoader","formData","frameworks","courses","completionmode","resourceid","resourceId","sesskey","call","methodname","args","response","hideLoader","success","error","console","initializeState","trigger"],"mappings":"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"}