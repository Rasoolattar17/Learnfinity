{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable no-console */\r\n/* eslint-disable promise/catch-or-return */\r\n/* eslint-disable promise/always-return */\r\n\r\ndefine([\r\n    \"jquery\",\r\n    \"core/str\",\r\n    \"core/ajax\",\r\n    \"core/notification\",\r\n    \"core/st_loader\",\r\n    \"core/url\",\r\n    'select2-js',\r\n], function(\r\n    $,\r\n    str,\r\n    ajax,\r\n    notification,\r\n    stLoader,\r\n    moodleurl\r\n) {\r\n    \"use strict\";\r\n    var apiCredentials = {\r\n        dom: {\r\n            main: null,\r\n            clientIdField: null,\r\n            clientSecretField: null,\r\n            scopeField: null,\r\n            grantTypeField: null,\r\n            saveButton: null,\r\n            updateButton: null,\r\n            form: null,\r\n            togglePassword: null\r\n        },\r\n        lang: {\r\n            somethingWentWrong: null,\r\n            saveSuccess: null,\r\n            updateSuccess: null,\r\n            showPassword: null,\r\n            hidePassword: null\r\n        },\r\n        variables: {\r\n            recordId: 0\r\n        },\r\n        url: {\r\n            vanta: function() {\r\n                return moodleurl.relativeUrl('/local/vanta/training_sync_rules.php');\r\n            }\r\n        },\r\n        action: {\r\n            getstringvalues: function() {\r\n                str.get_strings([\r\n                    {\r\n                        key: \"some_thing_went_wrong\",\r\n                        component: \"local_vanta\"\r\n                    },\r\n                    {\r\n                        key: \"save_success\",\r\n                        component: \"local_vanta\"\r\n                    },\r\n                    {\r\n                        key: \"update_success\",\r\n                        component: \"local_vanta\"\r\n                    },\r\n                    {\r\n                        key: \"show_password\",\r\n                        component: \"local_vanta\"\r\n                    },\r\n                    {\r\n                        key: \"hide_password\",\r\n                        component: \"local_vanta\"\r\n                    }\r\n                ]).done(function(langstrs) {\r\n                    apiCredentials.lang.somethingWentWrong = langstrs[0];\r\n                    apiCredentials.lang.saveSuccess = langstrs[1];\r\n                    apiCredentials.lang.updateSuccess = langstrs[2];\r\n                    apiCredentials.lang.showPassword = langstrs[3];\r\n                    apiCredentials.lang.hidePassword = langstrs[4];\r\n                    apiCredentials.init();\r\n                }).fail(function() {\r\n                    notification.addNotification({\r\n                        type: \"error\",\r\n                        message: \"Failed to load language strings\",\r\n                    });\r\n                });\r\n            },\r\n\r\n            validateForm: function() {\r\n                var isValid = true;\r\n                if (apiCredentials.dom.clientIdField.val().trim() === \"\") {\r\n                    apiCredentials.dom.clientIdField.addClass('is-invalid');\r\n                    isValid = false;\r\n                } else {\r\n                    apiCredentials.dom.clientIdField.removeClass('is-invalid');\r\n                }\r\n                if (apiCredentials.dom.clientSecretField.val().trim() === \"\") {\r\n                    apiCredentials.dom.clientSecretField.addClass('is-invalid');\r\n                    isValid = false;\r\n                } else {\r\n                    apiCredentials.dom.clientSecretField.removeClass('is-invalid');\r\n                }\r\n                return isValid;\r\n            },\r\n\r\n            togglePasswordVisibility: function() {\r\n                var isPasswordVisible = apiCredentials.dom.clientSecretField.attr('type') === 'text';\r\n                var newType = isPasswordVisible ? 'password' : 'text';\r\n                var newIcon = isPasswordVisible ? 'fa-eye' : 'fa-eye-slash';\r\n                var oldIcon = isPasswordVisible ? 'fa-eye-slash' : 'fa-eye';\r\n                var newTitle = isPasswordVisible ? apiCredentials.lang.showPassword : apiCredentials.lang.hidePassword;\r\n\r\n                apiCredentials.dom.clientSecretField.attr('type', newType);\r\n                apiCredentials.dom.togglePassword.find('i.fa')\r\n                    .removeClass(oldIcon)\r\n                    .addClass(newIcon);\r\n                apiCredentials.dom.togglePassword.attr('title', newTitle);\r\n            },\r\n\r\n            saveCredentials: function() {\r\n                stLoader.showLoader();\r\n                var request = {\r\n                    methodname: 'local_vanta_save_credentials',\r\n                    args: {\r\n                        name: apiCredentials.dom.nameField.val(),\r\n                        clientid: apiCredentials.dom.clientIdField.val(),\r\n                        clientsecret: apiCredentials.dom.clientSecretField.val(),\r\n                        scope: apiCredentials.dom.scopeField.val(),\r\n                        granttype: apiCredentials.dom.grantTypeField.val()\r\n                    }\r\n                };\r\n                ajax.call([request])[0].done(function(response) {\r\n                    stLoader.hideLoader();\r\n                    if (response.success) {\r\n                        apiCredentials.variables.recordId = response.id;\r\n                        notification.addNotification({\r\n                            type: \"success\",\r\n                            message: apiCredentials.lang.saveSuccess || \"API credentials saved successfully\"\r\n                        });\r\n                        window.location.href = apiCredentials.url.vanta();\r\n                    } else {\r\n                        notification.addNotification({\r\n                            type: \"error\",\r\n                            message: response.message || apiCredentials.lang.somethingWentWrong\r\n                        });\r\n                    }\r\n                }).fail(function(error) {\r\n                    stLoader.hideLoader();\r\n                    notification.addNotification({\r\n                        type: \"error\",\r\n                        message: apiCredentials.lang.somethingWentWrong\r\n                    });\r\n                    console.error(error);\r\n                });\r\n            },\r\n\r\n            updateCredentials: function() {\r\n                stLoader.showLoader();\r\n                var request = {\r\n                    methodname: 'local_vanta_update_credentials',   \r\n                    args: {\r\n                        name: apiCredentials.dom.nameField.val(),\r\n                        clientid: apiCredentials.dom.clientIdField.val(),\r\n                        clientsecret: apiCredentials.dom.clientSecretField.val(),\r\n                    }\r\n                };\r\n\r\n                ajax.call([request])[0].done(function(response) {\r\n                    stLoader.hideLoader();\r\n                    if (response.success) {\r\n                        notification.addNotification({\r\n                            type: \"success\",\r\n                            message: apiCredentials.lang.updateSuccess || \"API credentials updated successfully\"\r\n                        });\r\n                        window.location.href = apiCredentials.url.vanta();\r\n                    } else {\r\n                        notification.addNotification({\r\n                            type: \"error\",\r\n                            message: response.message || apiCredentials.lang.somethingWentWrong\r\n                        });\r\n                    }\r\n                }).fail(function(error) {\r\n                    stLoader.hideLoader();\r\n                    notification.addNotification({\r\n                        type: \"error\",\r\n                        message: apiCredentials.lang.somethingWentWrong\r\n                    });\r\n                    console.error(error);\r\n                });\r\n            }\r\n        },\r\n        init: function() {\r\n            apiCredentials.dom.main = $(\"#local_vanta_api_credentials\");\r\n            apiCredentials.dom.form = apiCredentials.dom.main.find(\"#vanta-config-form\");\r\n            apiCredentials.dom.nameField = apiCredentials.dom.main.find(\"#name\");\r\n            apiCredentials.dom.clientIdField = apiCredentials.dom.main.find(\"#client_id\");\r\n            apiCredentials.dom.clientSecretField = apiCredentials.dom.main.find(\"#client_secret\");\r\n            apiCredentials.dom.scopeField = apiCredentials.dom.main.find(\"#scope\");\r\n            apiCredentials.dom.grantTypeField = apiCredentials.dom.main.find(\"#grant_type\");\r\n            apiCredentials.dom.saveButton = apiCredentials.dom.main.find(\"#save_credentials\");\r\n            apiCredentials.dom.updateButton = apiCredentials.dom.main.find(\"#update_credentials\");\r\n            apiCredentials.dom.togglePassword = apiCredentials.dom.main.find(\".toggle-password\");\r\n\r\n            // Initialize password field as password type\r\n            apiCredentials.dom.clientSecretField.attr('type', 'password');\r\n\r\n            // Add toggle password event handler\r\n            apiCredentials.dom.togglePassword.on('click', function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                apiCredentials.action.togglePasswordVisibility();\r\n            });\r\n\r\n            // Form submission handler\r\n            apiCredentials.dom.form.on('submit', function(e) {\r\n                e.preventDefault();\r\n                if (apiCredentials.action.validateForm()) {\r\n                    apiCredentials.action.saveCredentials();\r\n                }\r\n            });\r\n\r\n            // Check if we have an existing record ID (for updates)\r\n            apiCredentials.variables.recordId = apiCredentials.dom.form.data('record-id') || 0;\r\n\r\n            if (apiCredentials.variables.recordId > 0) {\r\n                // We have an existing record, show update button\r\n                apiCredentials.dom.updateButton.removeClass('d-none');\r\n                apiCredentials.dom.saveButton.addClass('d-none');\r\n            } else {\r\n                // No existing record, show save button\r\n                apiCredentials.dom.saveButton.removeClass('d-none');\r\n                apiCredentials.dom.updateButton.addClass('d-none');\r\n            }\r\n        }\r\n    };\r\n    return {\r\n        init: apiCredentials.action.getstringvalues,\r\n    };\r\n});"],"names":["define","$","str","ajax","notification","stLoader","moodleurl","apiCredentials","dom","main","clientIdField","clientSecretField","scopeField","grantTypeField","saveButton","updateButton","form","togglePassword","lang","somethingWentWrong","saveSuccess","updateSuccess","showPassword","hidePassword","variables","recordId","url","vanta","relativeUrl","action","getstringvalues","get_strings","key","component","done","langstrs","init","fail","addNotification","type","message","validateForm","isValid","val","trim","addClass","removeClass","togglePasswordVisibility","isPasswordVisible","attr","newType","newIcon","oldIcon","newTitle","find","saveCredentials","showLoader","request","methodname","args","name","nameField","clientid","clientsecret","scope","granttype","call","response","hideLoader","success","id","window","location","href","error","console","updateCredentials","on","e","preventDefault","stopPropagation","data"],"mappings":"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"}