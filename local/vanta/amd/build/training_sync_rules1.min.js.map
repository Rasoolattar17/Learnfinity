{"version":3,"file":"training_sync_rules1.min.js","sources":["../src/training_sync_rules1.js"],"sourcesContent":["/* eslint-disable no-console */\r\n/* eslint-disable promise/catch-or-return */\r\n/* eslint-disable promise/always-return */\r\n\r\ndefine([\r\n    'jquery',\r\n    'core/str',\r\n    'core/ajax',\r\n    'core/notification',\r\n    'core/templates',\r\n    'core/st_loader',\r\n    'core/url',\r\n    'select2-js'\r\n], function(\r\n    $,\r\n    str,\r\n    ajax,\r\n    notification,\r\n    templates,\r\n    stLoader,\r\n) {\r\n    \"use strict\";\r\n    var trainingSyncRules = {\r\n        dom: {\r\n            main: null,\r\n            frameworksSelect: null,\r\n            coursesSelect: null,\r\n            completionModeContainer: null,\r\n            completionModeSelect: null,\r\n            saveButton: null,\r\n            form: null,\r\n            resourceId: null\r\n        },\r\n        lang: {\r\n            somethingWentWrong: null,\r\n            saveSuccess: null\r\n        },\r\n        variables: {\r\n            vantaId: 0,\r\n            selectedFrameworks: [],\r\n            selectedCourses: []\r\n        },\r\n        action: {\r\n            getStringValues: function() {\r\n                str.get_strings([\r\n                    {\r\n                        key: \"some_thing_went_wrong\",\r\n                        component: \"local_vanta\"\r\n                    },\r\n                    {\r\n                        key: \"settingssaved\",\r\n                        component: \"local_vanta\"\r\n                    }\r\n                ]).done(function(langstrs) {\r\n                    trainingSyncRules.lang.somethingWentWrong = langstrs[0];\r\n                    trainingSyncRules.lang.saveSuccess = langstrs[1];\r\n                    trainingSyncRules.init();\r\n                }).fail(function() {\r\n                    notification.addNotification({\r\n                        type: \"error\",\r\n                        message: \"Failed to load language strings\"\r\n                    });\r\n                });\r\n            },\r\n            validation: function() {\r\n                console.log('Running validation...');\r\n                var isValid = true;\r\n\r\n                // Validate resource ID\r\n                if (!trainingSyncRules.dom.resourceId || trainingSyncRules.dom.resourceId.val() === '') {\r\n                    console.log('Resource ID validation failed');\r\n                    if (trainingSyncRules.dom.resourceId) {\r\n                        trainingSyncRules.dom.resourceId.addClass('is-invalid');\r\n                    }\r\n                    isValid = false;\r\n                } else {\r\n                    if (trainingSyncRules.dom.resourceId) {\r\n                        trainingSyncRules.dom.resourceId.removeClass('is-invalid');\r\n                    }\r\n                }\r\n\r\n                // Validate frameworks\r\n                if (trainingSyncRules.variables.selectedFrameworks.length === 0) {\r\n                    console.log('Frameworks validation failed');\r\n                    if (trainingSyncRules.dom.frameworksSelect) {\r\n                        trainingSyncRules.dom.frameworksSelect.addClass('is-invalid');\r\n                    }\r\n                    isValid = false;\r\n                } else {\r\n                    if (trainingSyncRules.dom.frameworksSelect) {\r\n                        trainingSyncRules.dom.frameworksSelect.removeClass('is-invalid');\r\n                    }\r\n                }\r\n\r\n                // Validate courses\r\n                if (trainingSyncRules.variables.selectedCourses.length === 0) {\r\n                    console.log('Courses validation failed');\r\n                    if (trainingSyncRules.dom.coursesSelect) {\r\n                        trainingSyncRules.dom.coursesSelect.addClass('is-invalid');\r\n                    }\r\n                    isValid = false;\r\n                } else {\r\n                    if (trainingSyncRules.dom.coursesSelect) {\r\n                        trainingSyncRules.dom.coursesSelect.removeClass('is-invalid');\r\n                    }\r\n                }\r\n\r\n                console.log('Validation result:', isValid);\r\n                return isValid;\r\n            },\r\n\r\n            saveSettings: function() {\r\n                console.log('Starting save settings...');\r\n                stLoader.showLoader();\r\n\r\n                var formData = {\r\n                    frameworks: trainingSyncRules.variables.selectedFrameworks,\r\n                    courses: trainingSyncRules.variables.selectedCourses,\r\n                    completionmode: trainingSyncRules.dom.completionModeSelect.val(),\r\n                    resourceid: trainingSyncRules.dom.resourceId.val(),\r\n                };\r\n\r\n                console.log('Form data:', formData);\r\n\r\n                // Use standard Moodle AJAX call to save settings\r\n                ajax.call([{\r\n                    methodname: 'local_vanta_save_sync_rules',\r\n                    args: formData\r\n                }])[0].done(function(response) {\r\n                    stLoader.hideLoader();\r\n                    console.log('Save response:', response);\r\n\r\n                    if (response.success) {\r\n                        notification.addNotification({\r\n                            type: 'success',\r\n                            message: trainingSyncRules.lang.saveSuccess\r\n                        });\r\n                    } else {\r\n                        notification.addNotification({\r\n                            type: 'error',\r\n                            message: response.message || trainingSyncRules.lang.somethingWentWrong\r\n                        });\r\n                    }\r\n                }).fail(function(error) {\r\n                    stLoader.hideLoader();\r\n                    console.error('Save failed:', error);\r\n                    notification.addNotification({\r\n                        type: 'error',\r\n                        message: trainingSyncRules.lang.somethingWentWrong\r\n                    });\r\n                });\r\n            },\r\n        },\r\n\r\n        init: function() {\r\n            console.log('Initializing training sync rules...');\r\n\r\n            // Initialize DOM references with error checking\r\n            trainingSyncRules.dom.main = $('#local_vanta_training_sync_rules');\r\n            trainingSyncRules.dom.form = $('#vanta-sync-rules-form');\r\n            trainingSyncRules.dom.frameworksSelect = $('#frameworks');\r\n            trainingSyncRules.dom.coursesSelect = $('#courses');\r\n            trainingSyncRules.dom.resourceId = $('.resource_id');\r\n            trainingSyncRules.dom.completionModeContainer = $('#completion_mode_container');\r\n            trainingSyncRules.dom.completionModeSelect = $('#completion_mode');\r\n            trainingSyncRules.dom.saveButton = $('.save-sync-rules');\r\n\r\n\r\n               // Handle save button click with enhanced error handling\r\n            trainingSyncRules.dom.saveButton.on('click', function(e) {\r\n                console.log('Save button clicked');\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n\r\n                // Update variables before validation\r\n                trainingSyncRules.variables.selectedFrameworks = trainingSyncRules.dom.frameworksSelect.val() || [];\r\n                trainingSyncRules.variables.selectedCourses = trainingSyncRules.dom.coursesSelect.val() || [];\r\n\r\n                if (trainingSyncRules.action.validation()) {\r\n                    trainingSyncRules.action.saveSettings();\r\n                }\r\n\r\n            });\r\n\r\n\r\n            // Debug DOM elements\r\n            console.log('DOM elements found:');\r\n            console.log('- Main container:', trainingSyncRules.dom.main.length);\r\n            console.log('- Form:', trainingSyncRules.dom.form.length);\r\n            console.log('- Frameworks select:', trainingSyncRules.dom.frameworksSelect.length);\r\n            console.log('- Courses select:', trainingSyncRules.dom.coursesSelect.length);\r\n            console.log('- Resource ID:', trainingSyncRules.dom.resourceId.length);\r\n            console.log('- Save button:', trainingSyncRules.dom.saveButton.length);\r\n\r\n            // Store initial values\r\n            trainingSyncRules.variables.selectedFrameworks = trainingSyncRules.dom.frameworksSelect.val() || [];\r\n            trainingSyncRules.variables.selectedCourses = trainingSyncRules.dom.coursesSelect.val() || [];\r\n\r\n            // Initialize completion mode visibility based on initial course selection\r\n            if (trainingSyncRules.variables.selectedCourses.length > 1) {\r\n                trainingSyncRules.dom.completionModeContainer.show();\r\n                if (!trainingSyncRules.dom.completionModeSelect.val()) {\r\n                    trainingSyncRules.dom.completionModeSelect.val('any');\r\n                }\r\n            } else {\r\n                trainingSyncRules.dom.completionModeContainer.hide();\r\n                trainingSyncRules.dom.completionModeSelect.val('any');\r\n            }\r\n\r\n            // Initialize select2 with error handling\r\n            if (trainingSyncRules.dom.frameworksSelect.length > 0) {\r\n                try {\r\n                    trainingSyncRules.dom.frameworksSelect.select2({\r\n                        placeholder: \"Select compliance frameworks\",\r\n                        allowClear: true,\r\n                        width: '100%'\r\n                    });\r\n                } catch (e) {\r\n                    console.error('Error initializing frameworks select2:', e);\r\n                }\r\n            }\r\n\r\n            // Initialize select2 on courses\r\n            if (trainingSyncRules.dom.coursesSelect.length > 0) {\r\n                try {\r\n                    trainingSyncRules.dom.coursesSelect.select2({\r\n                        placeholder: \"Select courses\",\r\n                        allowClear: true,\r\n                        width: '100%'\r\n                    });\r\n                } catch (e) {\r\n                    console.error('Error initializing courses select2:', e);\r\n                }\r\n            }\r\n\r\n            // Handle course selection change for conditional display\r\n            trainingSyncRules.dom.coursesSelect.on('change', function() {\r\n                console.log('Course selection changed');\r\n                var selectedCourses = $(this).val();\r\n                trainingSyncRules.variables.selectedCourses = selectedCourses || [];\r\n\r\n                // Show/hide completion mode selector based on number of selected courses\r\n                if (selectedCourses && selectedCourses.length > 1) {\r\n                    trainingSyncRules.dom.completionModeContainer.show();\r\n                    // Set default value to 'any' if not already set\r\n                    if (!trainingSyncRules.dom.completionModeSelect.val()) {\r\n                        trainingSyncRules.dom.completionModeSelect.val('any');\r\n                    }\r\n                } else {\r\n                    trainingSyncRules.dom.completionModeContainer.hide();\r\n                    // Reset to 'any' when hiding\r\n                    trainingSyncRules.dom.completionModeSelect.val('any');\r\n                }\r\n            });\r\n\r\n            // Handle frameworks selection change\r\n            trainingSyncRules.dom.frameworksSelect.on('change', function() {\r\n                trainingSyncRules.variables.selectedFrameworks = $(this).val() || [];\r\n            });\r\n\r\n            // Prevent form submission\r\n            if (trainingSyncRules.dom.form.length > 0) {\r\n                trainingSyncRules.dom.form.on('submit', function(e) {\r\n                    console.log('Form submit prevented');\r\n                    e.preventDefault();\r\n                    return false;\r\n                });\r\n            }\r\n\r\n            console.log('Training sync rules initialization complete');\r\n        }\r\n    };\r\n    return {\r\n        init: trainingSyncRules.action.getStringValues\r\n    };\r\n});"],"names":["define","$","str","ajax","notification","templates","stLoader","trainingSyncRules","dom","main","frameworksSelect","coursesSelect","completionModeContainer","completionModeSelect","saveButton","form","resourceId","lang","somethingWentWrong","saveSuccess","variables","vantaId","selectedFrameworks","selectedCourses","action","getStringValues","get_strings","key","component","done","langstrs","init","fail","addNotification","type","message","validation","console","log","isValid","val","removeClass","addClass","length","saveSettings","showLoader","formData","frameworks","courses","completionmode","resourceid","call","methodname","args","response","hideLoader","success","error","on","e","preventDefault","stopPropagation","show","hide","select2","placeholder","allowClear","width","this"],"mappings":"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"}