/**
 * JavaScript for the Vanta logs page.
 *
 * @module     local_vanta/logs
 * @copyright  2023 Your Name
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_vanta/logs",["jquery","core/ajax","core/notification","core/templates","core/str"],(function($,ajax,notification,templates,str){var logs={filters:{useremail:"",courseid:0,status:"",fromdate:"",todate:""},page:0,perpage:10,init:function(){this.filters.useremail=$("#vanta-logs-filter-useremail").val(),this.filters.courseid=parseInt($("#vanta-logs-filter-courseid").val())||0,this.filters.status=$("#vanta-logs-filter-status").val(),this.filters.fromdate=$("#vanta-logs-filter-fromdate").val(),this.filters.todate=$("#vanta-logs-filter-todate").val(),this.bindEvents()},bindEvents:function(){var self=this;$("#vanta-logs-filter-form").on("submit",(function(e){e.preventDefault();var fromdate=$("#vanta-logs-filter-fromdate").val(),todate=$("#vanta-logs-filter-todate").val();if(fromdate&&todate){var fromTimestamp=new Date(fromdate).getTime();if(new Date(todate).getTime()<fromTimestamp)return $(".form-control").removeClass("is-invalid"),$(".invalid-feedback").remove(),$("#vanta-logs-filter-todate").addClass("is-invalid"),void str.get_string("date_validation_error","local_vanta").then((function(errorStr){$("#vanta-logs-filter-todate").siblings(".invalid-feedback").remove(),$("#vanta-logs-filter-todate").after('<div class="invalid-feedback">'+errorStr+"</div>")})).catch((function(){$("#vanta-logs-filter-todate").siblings(".invalid-feedback").remove(),$("#vanta-logs-filter-todate").after('<div class="invalid-feedback">To date cannot be earlier than from date.</div>')}))}$(".form-control").removeClass("is-invalid"),$(".invalid-feedback").remove(),self.filters.useremail=$("#vanta-logs-filter-useremail").val(),self.filters.courseid=parseInt($("#vanta-logs-filter-courseid").val())||0,self.filters.status=$("#vanta-logs-filter-status").val(),self.filters.fromdate=fromdate,self.filters.todate=todate,self.page=0,self.loadLogs()})),$("#vanta-logs-filter-reset").on("click",(function(e){e.preventDefault(),$("#vanta-logs-filter-form")[0].reset(),$(".form-control").removeClass("is-invalid"),$(".invalid-feedback").remove(),self.filters={useremail:"",courseid:0,status:"",fromdate:"",todate:""},self.page=0,self.loadLogs()})),$(document).on("click",".vanta-logs-pagination .page-link",(function(e){e.preventDefault();var page=$(this).data("page");void 0!==page&&(self.page=parseInt(page),self.loadLogs())}))},loadLogs:function(){var self=this;$("#vanta-logs-loading").removeClass("d-none"),$("#vanta-logs-content").addClass("d-none"),ajax.call([{methodname:"local_vanta_get_logs",args:{page:self.page,perpage:self.perpage,filters:self.filters}}])[0].done((function(response){var data={logs:response.logs,has_logs:response.logs.length>0,total_logs:response.total,showing_from:response.showing_from,showing_to:response.showing_to,has_pagination:response.total>self.perpage};if(data.has_pagination){data.pages=[];var totalPages=Math.ceil(response.total/self.perpage);self.page>0&&data.pages.push({number:self.page-1,text:"«",active:!1});for(var i=0;i<totalPages;i++)data.pages.push({number:i,text:(i+1).toString(),active:i===self.page});self.page<totalPages-1&&data.pages.push({number:self.page+1,text:"»",active:!1})}if(data.has_logs){if($(".card-header small").html("Showing entries: "+data.showing_from+" - "+data.showing_to+" of "+data.total_logs),(tbody=$("#vanta-logs-display-table tbody")).empty(),data.logs.forEach((function(log){var statusBadge="";statusBadge=log.status_success?'<span class="badge badge-success"><i class="fa fa-check-circle"></i> Success</span>':log.status_error?'<span class="badge badge-danger"><i class="fa fa-times-circle"></i> Error</span>':log.status_info?'<span class="badge badge-info"><i class="fa fa-info-circle"></i> Info</span>':log.status_skipped?'<span class="badge badge-secondary"><i class="fa fa-minus-circle"></i> Skipped</span>':'<span class="badge badge-light"><i class="fa fa-question-circle"></i> Unknown</span>';var row="<tr><td>"+log.useremail+"</td><td>"+log.coursename+'</td><td data-sort="'+log.syncedon+'">'+log.syncedon_formatted+"</td><td>"+statusBadge+'</td><td><a href="'+log.view_url+'" class="btn btn-sm btn-primary" title="View Details"><i class="fa fa-eye"></i> View</a></td></tr>';tbody.append(row)})),$(".card-body .pagination").parent().remove(),$(".card-body .vanta-logs-pagination").parent().remove(),data.has_pagination){var paginationHtml='<nav aria-label="Pagination"><ul class="pagination justify-content-center vanta-logs-pagination">';data.pages.forEach((function(page){var activeClass=page.active?" active":"";paginationHtml+='<li class="page-item'+activeClass+'"><a class="page-link" href="#" data-page="'+page.number+'">'+page.text+"</a></li>"})),paginationHtml+="</ul></nav>",$(".card-body").append('<div class="mt-3">'+paginationHtml+"</div>")}$("#vanta-logs-display-table").closest(".table-responsive").show(),$(".card").show()}else{var tbody;$(".card-header small").html("No entries found"),(tbody=$("#vanta-logs-display-table tbody")).html('<tr><td colspan="5" class="text-center">No logs found matching the current filters.</td></tr>'),$(".card-body .pagination").parent().remove(),$(".card-body .vanta-logs-pagination").parent().remove()}$("#vanta-logs-loading").addClass("d-none"),$("#vanta-logs-content").removeClass("d-none")})).fail(notification.exception)}};return{init:function(){logs.init()}}}));

//# sourceMappingURL=logs.min.js.map